<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" href="https://hazuki.cn/rss.xml"><link rel="alternate" type="application/atom+xml" href="https://hazuki.cn/atom.xml"><link rel="alternate" type="application/json" href="https://hazuki.cn/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/css/app.css?v=0.2.5"><meta name="keywords" content="机器学习,Scikit-learn Cookbook"><link rel="canonical" href="https://hazuki.cn/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC4%E7%AB%A0%20%E4%BD%BF%E7%94%A8%20scikit-learn%20%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB/"><title>第 4 章 使用 scikit-learn 对数据分类 - Scikit-learn Cookbook - 机器学习 - 计算机科学 | Hazuki の 小屋 = = 葉月書架</title><meta name="generator" content="Hexo 5.4.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">第 4 章 使用 scikit-learn 对数据分类</h1><div class="meta"><span class="item" title="创建时间：2021-12-03 18:44:50"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-12-03T18:44:50+08:00">2021-12-03</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>24k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>22 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Hazuki の 小屋</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeu1usa7j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giciub8ja1j20zk0m81ky.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclh0m9pdj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipexj2jgzj20zk0m8b09.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/machine-learing/" itemprop="item" rel="index" title="分类于 机器学习"><span itemprop="name">机器学习</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" itemprop="item" rel="index" title="分类于 Scikit-learn Cookbook"><span itemprop="name">Scikit-learn Cookbook</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hazuki.cn/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC4%E7%AB%A0%20%E4%BD%BF%E7%94%A8%20scikit-learn%20%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/images/avatar.jpg"><meta itemprop="name" content="Hazuki 叶月"><meta itemprop="description" content="葉月書架, 计算机基础 & 编程笔记"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""></span><div class="body md" itemprop="articleBody"><div class="note info"><p>本文转载自：<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vd2l6YXJkZm9yY2VsL3NrbGVhcm4tY2I=">https://gitee.com/wizardforcel/sklearn-cb</span><br>未经作者的许可，此代码仅用于学习，不能用于其他用途。</p></div><h1 id="第四章-使用-scikit-learn-对数据分类"><a class="anchor" href="#第四章-使用-scikit-learn-对数据分类">#</a> 第四章 使用 scikit-learn 对数据分类</h1><p>分类在大量语境下都非常重要。例如，如果我们打算自动化一些决策过程，我们可以利用分类。在我们需要研究诈骗的情况下，有大量的事务，人去检查它们是不实际的。所以，我们可以使用分类都自动化这种决策。</p><h1 id="使用决策树实现基本的分类"><a class="anchor" href="#使用决策树实现基本的分类">#</a> 使用决策树实现基本的分类</h1><p>这个秘籍中，我们使用决策树执行基本的分类。它们是非常不错的模型，因为它们很易于理解，并且一旦训练完成，评估就很容易。通常可以使用 SQL 语句，这意味着结果可以由许多人使用。</p><h2 id="准备"><a class="anchor" href="#准备">#</a> 准备</h2><p>这个秘籍中，我们会看一看决策树。我喜欢将决策树看做基类，大量的模型从中派生。它是个非常简单的想法，但是适用于大量的情况。</p><p>首先，让我们获取一些分类数据，我们可以使用它来练习：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span> n_features<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                        n_redundant<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="操作步骤"><a class="anchor" href="#操作步骤">#</a> 操作步骤</h2><p>处理决策树非常简单。我们首先需要导入对象，之后训练模型：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> DecisionTreeClassifier<span class="token punctuation">(</span>compute_importances<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> criterion<span class="token operator">=</span><span class="token string">'gini'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                        max_depth<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> max_features<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                        max_leaf_nodes<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> min_density<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                        min_samples_leaf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> min_samples_split<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                        random_state<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> splitter<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> preds <span class="token operator">=</span> dt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span>y <span class="token operator">==</span> preds<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">1.0</span></pre></td></tr></table></figure><p>你可以看到，我们猜测它是正确的。显然，这只是凑合着运行。现在我们研究一些选项。</p><p>首先，如果你观察 <code>dt</code> 对象，它拥有多种关键字参数，决定了对象的行为。我们如何选择对象十分重要，所以我们要详细观察对象的效果。</p><p>我们要观察的第一个细节是 <code>max_depth</code> 。这是个重要的参数，决定了允许多少分支。这非常重要，因为决策树需要很长时间来生成样本外的数据，它们带有一些类型的正则化。之后，我们会看到，我们如何使用多种浅层决策树，来生成更好的模型。让我们创建更复杂的数据集并观察当我们允许不同 <code>max_depth</code> 时会发生什么。我们会将这个数据及用于剩下的秘籍。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> n_features<span class="token operator">=</span><span class="token number">200</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span><span class="token number">750</span><span class="token punctuation">,</span> n_features<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                        n_informative<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> training <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">.75</span><span class="token punctuation">,</span> <span class="token number">.25</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                                size<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> accuracies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_features<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span>x<span class="token punctuation">)</span>    </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span>    </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> preds <span class="token operator">=</span> dt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span>    </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> accuracies<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>preds <span class="token operator">==</span> y<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_features<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> accuracies<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Decision Tree Accuracy"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"% Correct"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Max Depth"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-1-1.jpg" alt=""></p><p>我们可以看到，我们实际上在较低最大深度处得到了漂亮的准确率。让我们进一步看看低级别的准确率，首先是 15：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> N <span class="token operator">=</span> <span class="token number">15</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> n_features<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> accuracies<span class="token punctuation">[</span><span class="token punctuation">:</span>N<span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Decision Tree Accuracy"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"% Correct"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Max Depth"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-1-2.jpg" alt=""></p><p>这个就是我们之前看到的峰值。比较令人惊讶的是它很快就下降了。最大深度 1 到 3 可能几乎是相等的。决策树很擅长分离规则，但是需要控制。</p><p>我们观察 <code>compute_importances</code> 参数。对于随机森林来说，它实际上拥有更广泛的含义。但是我们要更好地了解它。同样值得注意的是，如果你使用了 0.16 或之前的版本，你可以尽管这样做：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt_ci <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>compute_importances<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#plot the importances </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ne0 <span class="token operator">=</span> dt<span class="token punctuation">.</span>feature_importances_ <span class="token operator">!=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> y_comp <span class="token operator">=</span> dt<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">[</span>ne0<span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> x_comp <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>dt<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>ne0<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>bar<span class="token punctuation">(</span>x_comp<span class="token punctuation">,</span> y_comp<span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-1-3.jpg" alt=""></p><blockquote><p>要注意，你可能会得到一个错误，让你知道你不再需要显式设置 <code>compute_importances</code> 。</p></blockquote><p>我们看到，这些特征之一非常重要，后面跟着几个其它特征。</p><h2 id="工作原理"><a class="anchor" href="#工作原理">#</a> 工作原理</h2><p>简单来说，我们所有时间都在构造决策树。当思考场景以及将概率分配给结果时，我们构造了决策树。我们的规则更加复杂，并涉及很多上下文，但是使用决策树，我们关心的所有东西都是结果之间的差异，假设特征的一些信息都是已知的。</p><p>现在，让我们讨论熵和基尼系数之间的差异。</p><p>熵不仅仅是给定变量的熵值，如果我们知道元素的值，它表示了熵中的变化。这叫做信息增益（IG），数学上是这样：</p><pre><code>IG(Data,KnownFeatures) = H(Data) - H(Data|KnownFeatures)
</code></pre><p>对于基尼系数，我们关心的是，提供新的信息，一个数据点有多可能被错误标记。</p><p>熵和基尼系数都有优缺点。也就是说，如果你观察它们工作方式的主要差异，这可能是个重新验证你的假设的好方式。</p><h1 id="调整决策树模型"><a class="anchor" href="#调整决策树模型">#</a> 调整决策树模型</h1><p>如果我们仅仅使用基本的决策树实现，可能拟合得不是很好。所以我们需要调参，以便获得更好的拟合。这非常简单，并且不用花费什么精力。</p><h2 id="准备-2"><a class="anchor" href="#准备-2">#</a> 准备</h2><p>这个秘籍中，我们深入了解如何调整决策树分类器。有几个渲染，并且在上一个秘籍中，我们仅仅查看了它们之一。</p><p>我们会训练一个基本的模型，并实际观察决策树是什么样子。之后，我们会重新检测每个决策，并且指出不同的修改如何影响结构。</p><p>如果你打算遵循这个秘籍，需要安装 <code>pydot</code> 。</p><h2 id="操作步骤-2"><a class="anchor" href="#操作步骤-2">#</a> 操作步骤</h2><p>比起其它算法，决策树有许多 “把手”，因为我们旋转把手时，易于发现发生了什么。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> n_informative<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><p>好的，所以既然我们训练了基本的分类器，我们可以快速地查看它：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> StringIO <span class="token keyword">import</span> StringIO</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> tree </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pydot</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> str_buffer <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> tree<span class="token punctuation">.</span>export_graphviz<span class="token punctuation">(</span>dt<span class="token punctuation">,</span> out_file<span class="token operator">=</span>str_buffer<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> graph <span class="token operator">=</span> pydot<span class="token punctuation">.</span>graph_from_dot_data<span class="token punctuation">(</span>str_buffer<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> graph<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"myfile.jpg"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这张图几乎难以辨认，但是这展示了一颗复杂的树，它可以使用非最优的决策树，作为结果生成。</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-2-1.jpg" alt=""></p><p>哇哦！这是个非常复杂的树，看上去对数据过拟合了。首先，让我们降低最大深度值：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>顺带一说，如果你想知道为什么能看到分号，通常是 <code>repr</code> ，它实际上是决策树的模型。例如 <code>fit</code> 函数实际上返回决策树对象，它允许链式调用：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><p>现在，让我们返回正常的程序。</p><p>由于我们会多次绘制它，我们创建一个函数。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">plot_dt</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>       str_buffer <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> tree<span class="token punctuation">.</span>export_graphviz<span class="token punctuation">(</span>model<span class="token punctuation">,</span> out_file<span class="token operator">=</span>str_buffer<span class="token punctuation">)</span>    </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> graph <span class="token operator">=</span> pydot<span class="token punctuation">.</span>graph_from_dot_data<span class="token punctuation">(</span>str_buffer<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> graph<span class="token punctuation">.</span>write_jpg<span class="token punctuation">(</span>filename<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> plot_dt<span class="token punctuation">(</span>dt<span class="token punctuation">,</span> <span class="token string">"myfile.png"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>会生成下面的图：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-2-2.jpg" alt=""></p><p>这棵树稍微简单了一些。让我们看看，如果我们将熵用作分割标准，会发生什么：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>criterion<span class="token operator">=</span><span class="token string">'entropy'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                                 max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> plot<span class="token punctuation">(</span>dt<span class="token punctuation">,</span> <span class="token string">"entropy.png"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>会生成下面的图：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-2-3.jpg" alt=""></p><p>很容易看到，前两个分割是相同特征，之后的分割以相似总数分布。这是个良好的合理的检查。</p><p>同样，注意第一个分割的熵是 0.999，但是使用基尼系数的时候是 0.5。我们需要弄清楚，决策树的分割的两种度量有什么不同。更多信息请见下面的工作原理一节。但是，如果我们想要使用熵穿件决策树，我们必须使用下列命令：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>min_samples_leaf<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                                criterion<span class="token operator">=</span><span class="token string">'entropy'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                max_depth<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="工作原理-2"><a class="anchor" href="#工作原理-2">#</a> 工作原理</h2><p>决策树，通常容易出现过拟合。由于它的自身特性，决策树经常会过拟合，所以，我们需要思考，如何避免过拟合，这是为了避免复杂性。实战中，简单的模型通常会执行得更好。</p><p>我们即将在实战中看到这个理念。随机森林会在简单模型的理念上构建。</p><h1 id="使用许多决策树-随机森林"><a class="anchor" href="#使用许多决策树-随机森林">#</a> 使用许多决策树 -- 随机森林</h1><p>这个秘籍中，我们会将随机森林用于分类任务。由于随机森林对于过拟合非常健壮，并且在大量场景中表现良好，所以使用它。</p><h2 id="准备-3"><a class="anchor" href="#准备-3">#</a> 准备</h2><p>我们会在工作原理一节中深入探索，但是随即森林通过构造大量浅层树，之后让每颗树为分类投票，再选取投票结果。这个想法在机器学习中十分有效。如果我们发现简单训练的分类器只有 60% 的准确率，我们可以训练大量分类器，它们通常是正确的，并且随后一起使用它们。</p><h2 id="操作步骤-3"><a class="anchor" href="#操作步骤-3">#</a> 操作步骤</h2><p>训练随机森林分类器的机制在 Scikit 中十分容易。这一节中，我们执行以下步骤：</p><ol><li><p>创建用于练习的样例数据集</p></li><li><p>训练基本的随机森林对象</p></li><li><p>看一看训练对象的一些属性</p></li></ol><p>下一个秘籍中，我们会观察如何调整随机森林分类器，让我们以导入数据集来开始：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets</pre></td></tr></table></figure><p>之后，使用 1000 个样例创建数据集：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>既然我们拥有了数据，我们可以创建分类器对象并训练它：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们想做的第一件事，就是看看如何拟合训练数据。我们可以将 <code>predict</code> 方法用于这些东西：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> <span class="token string">"Accuracy:\t"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>Accuracy<span class="token punctuation">:</span>   <span class="token number">0.993</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> <span class="token string">"Total Correct:\t"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Total </pre></td></tr><tr><td data-num="4"></td><td><pre>Correct<span class="token punctuation">:</span>   <span class="token number">993</span></pre></td></tr></table></figure><p>现在，让我们查看一些属性和犯法。</p><p>首先，我们查看一些实用属性。这里，由于我们保留默认值，它们是对象的默认值：</p><ul><li><p><code>rf.criterion</code> ：这是决定分割的标准。默认是 <code>gini</code> 。</p></li><li><p><code>rf.bootstrap</code> ：布尔值，表示在训练随机森林时是否使用启动样例</p></li><li><p><code>rf.n_jobs</code> ：训练和预测的任务数量。如果你打算使用所有处理器，将其设置为 <code>-1</code> 。要记住，如果你的数据集不是非常大，使用过多任务通常会导致浪费，因为处理器之间需要序列化和移动。</p></li><li><p><code>rf.max_features</code> ：这表示执行最优分割时，考虑的特征数量。在调参过程中这会非常方便。</p></li><li><p><code>rf.conpute_importtances</code> ：这有助于我们决定，是否计算特征的重要性。如何使用它的信息，请见更多一节。</p></li><li><p><code>rf.max_depth</code> ：这表示树的深度。</p></li></ul><p>有许多属性需要注意，更多信息请查看官方文档。</p><p>不仅仅是 <code>predect</code> 方法很实用，我们也可以从独立的样子获取概率。这是个非常实用的特性，用于理解每个预测的不确定性。例如，我们可以预测每个样例对于不同类的概率。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> probs <span class="token operator">=</span> rf<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> probs_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>probs<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>></span><span class="token operator">></span> probs_df<span class="token punctuation">[</span><span class="token string">'was_correct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">==</span> y</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> probs_df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>was_correct<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Accuracy at 0 class probability"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"% Correct"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"% trees for 0"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-3-1.jpg" alt=""></p><h2 id="工作原理-3"><a class="anchor" href="#工作原理-3">#</a> 工作原理</h2><p>随机森轮实用预定义数量的弱决策树，并且使用数据的自己训练每一颗树。这对于避免过拟合至关重要。这也是 <code>bootstrap</code> 参数的原因。我们的每个树拥有下列东西：</p><ul><li><p>票数最多的类</p></li><li><p>输出，如果我们使用回归树</p></li></ul><p>当然，它们是表现上的考量，这会在下一个秘籍中设计。但是出于礼节随机森林如何工作的目的，我们训练一些平均数，作为结果，获得了非常好的分类器。</p><h2 id="更多"><a class="anchor" href="#更多">#</a> 更多</h2><p>特征重要性是随机森林的不错的副产品。这通常有助于回答一个问题：如果我们拥有 10 个特征，对于判断数据点的真实类别，哪个特征是最重要的？真实世界中的应用都易于观察。例如，如果一个事务是不真实的，我们可能想要了解，是否有特定的信号，可以用于更快弄清楚事务的类别。</p><p>如果我们打算极端特征重要性，我们需要在我们创建对象时说明。如果你使用 scikit-learn 0.15，你可能会得到一个警告，说这不是必需的。在 0.16 中，警告会被移除。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>compute_importances<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>bar<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>rf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            rf<span class="token punctuation">.</span>feature_importances_<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Feature Importances"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>下面就是输出：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-3-2.jpg" alt=""></p><p>我们可以看到，在判断结果是类 0 或者 1 时，特定的特征比其它特征重要。</p><h1 id="调整随机森林模型"><a class="anchor" href="#调整随机森林模型">#</a> 调整随机森林模型</h1><p>在上一个秘籍中，我们学习了如何使用随机森林分类器。在这个秘籍中，我们会浏览如何通过调整参数来调整它的表现。</p><h2 id="准备-4"><a class="anchor" href="#准备-4">#</a> 准备</h2><p>为了调整随机森林模型，我们首先需要创建数据集，它有一些难以预测。之后，我们修改参数并且做一些预处理来更好地拟合数据集。</p><p>所以，让我们首先创建数据集：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                        n_features<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                                        n_informative<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                                        flip_y<span class="token operator">=</span><span class="token number">.5</span><span class="token punctuation">,</span> weights<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">.2</span><span class="token punctuation">,</span> <span class="token number">.8</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="操作步骤-4"><a class="anchor" href="#操作步骤-4">#</a> 操作步骤</h2><p>这个秘籍中，我们执行下列操作：</p><ol><li><p>创建训练和测试集。和上个秘籍不同，如果不与训练集比较，调整模型就毫无用途。</p></li><li><p>训练基本的随机森林，来评估原始算法有多好。</p></li><li><p>用系统化的方式修改一些参数，之后观察拟合会发生什么变化。</p></li></ol><p>好了，启动解释器并导入 NumPy：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> training <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">.8</span><span class="token punctuation">,</span> <span class="token number">.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                size<span class="token operator">=</span>y<span class="token punctuation">.</span>shape<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>ensemble <span class="token keyword">import</span> RandomForestClassifier</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> preds <span class="token operator">=</span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> <span class="token string">"Accuracy:\t"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>preds <span class="token operator">==</span> y<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>Accuracy<span class="token punctuation">:</span> <span class="token number">0.652239557121</span></pre></td></tr></table></figure><p>我打算用一些花招，引入模型评估度量之一，我们会在这本书后面讨论它。准确率是第一个不错的度量，但是使用混淆矩阵会帮助我们理解发生了什么。</p><p>让我们迭代 <code>max_features</code> 的推荐选项，并观察对拟合有什么影响。我们同事迭代一些浮点值，它们是所使用的特征的分数。使用下列命令：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> confusion_matrix</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> max_feature_params <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'auto'</span><span class="token punctuation">,</span> <span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string">'log2'</span><span class="token punctuation">,</span> <span class="token number">.01</span><span class="token punctuation">,</span> <span class="token number">.5</span><span class="token punctuation">,</span> <span class="token number">.99</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_matrixes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> max_feature <span class="token keyword">in</span> max_feature_params<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>max_features<span class="token operator">=</span>max_feature<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span>    </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_matrixes<span class="token punctuation">[</span>max_feature<span class="token punctuation">]</span> <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>由于我使用了 <code>ravel</code> 方法，我们的二维数组现在变成了一维。</p><p>现在，导入 Pandas 并查看刚刚创建的混淆矩阵：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>confusion_matrixes<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> itertools </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Guessed vs Correct (i, j) where i is the guess and j is the actual."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> j <span class="token builtin">list</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Guessed vs Correct"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"Correct"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-4-1.jpg" alt=""></p><p>虽然我们看不到表现中的任何真正的差异，对于你自己的项目来说，这是个非常简单的过程。让我们试一试 <code>n_estimator</code> 选项，但是使用原始的精确度。使用一些更多的选项，我们的图表就会变得很密集，难以使用。</p><p>由于我们正在使用混淆矩阵，我们可以从混淆矩阵的迹除以总和来计算准确度。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> n_estimator_params <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_matrixes <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> n_estimator <span class="token keyword">in</span> n_estimator_params<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span>n_estimator<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        confusion_matrixes<span class="token punctuation">[</span>n_estimator<span class="token punctuation">]</span> <span class="token operator">=</span> confusion_matrix<span class="token punctuation">(</span>y<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                                          rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token operator">~</span>training<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment"># here's where we'll update the confusion matrix with the operation we talked about   </span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> accuracy <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> np<span class="token punctuation">.</span>trace<span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> confusion_matrixes<span class="token punctuation">[</span>n_estimator<span class="token punctuation">]</span> <span class="token operator">=</span> accuracy<span class="token punctuation">(</span>confusion_matrixes<span class="token punctuation">[</span>n_estimator<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> accuracy_series <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>confusion_matrixes<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> itertools </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> accuracy_series<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">,</span> ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.75</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>grid<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"Accuracy by Number of Estimators"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># we want the full scope </span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">"Accuracy"</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">"Number of Estimators"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-4-2.jpg" alt=""></p><p>现在对于大多数部分，准确度是如何上升的呢？确实有一些随机性和准确度相关，但是图像从左到右是上升的。在下面的工作原理一节，我们会讨论随机森林和 bootstrap 之间的关系，以及哪个通常更好。</p><h2 id="工作原理-4"><a class="anchor" href="#工作原理-4">#</a> 工作原理</h2><p>bootstarp 是个不错的技巧，用于扩展模型的其它部分。通常用于介绍 bootstarp 的案例是将标准误差与中位数相加。这里，我们估算了结果，并将估算聚集为概率。</p><p>所以，通过简单增加估算器的数量，我们增加了子样本，产生了整体上更快的收敛。</p><h2 id="更多-2"><a class="anchor" href="#更多-2">#</a> 更多</h2><p>我们可能打算加快训练过程。我之前提到了这个过程，但是同时，我们可以将 <code>n_jobs</code> 设为我们想要训练的树的数量。这应该大致等于机器的核数。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>Parallel<span class="token punctuation">(</span>n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Done  <span class="token number">1</span> out of  <span class="token number">4</span> <span class="token operator">|</span> elapsed<span class="token punctuation">:</span>  <span class="token number">0.</span>3s remaining<span class="token punctuation">:</span> <span class="token number">0.</span>9s </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>Parallel<span class="token punctuation">(</span>n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Done  <span class="token number">4</span> out of  <span class="token number">4</span> <span class="token operator">|</span> elapsed<span class="token punctuation">:</span>  <span class="token number">0.</span>3s finished</pre></td></tr></table></figure><p>这也可以并行预测：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> rf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>Parallel<span class="token punctuation">(</span>n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Done  <span class="token number">1</span> out of  <span class="token number">4</span> <span class="token operator">|</span> elapsed<span class="token punctuation">:</span>  <span class="token number">0.</span>0s remaining<span class="token punctuation">:</span>    <span class="token number">0.</span>0s </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>Parallel<span class="token punctuation">(</span>n_jobs<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span> Done  <span class="token number">4</span> out of  <span class="token number">4</span> <span class="token operator">|</span> elapsed<span class="token punctuation">:</span>  <span class="token number">0.</span>0s finished </pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="使用支持向量机对数据分类"><a class="anchor" href="#使用支持向量机对数据分类">#</a> 使用支持向量机对数据分类</h1><p>支持向量机（SVM）是我们使用的技巧之一，它不能轻易用概率解释。SVM 背后的原理是，我们寻找一个平面，，它将数据集分割为组，并且是最优的。这里，分割的意思是，平面的选择使平面上最接近的点之间的间距最大。这些点叫做支持向量。</p><h2 id="准备-5"><a class="anchor" href="#准备-5">#</a> 准备</h2><p>SVM 是我最喜欢的机器学习算法之一，它是我在学校中学习的第一批机器学习伏安法之一。所以，让我们获得一些数据并开始吧。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="操作步骤-5"><a class="anchor" href="#操作步骤-5">#</a> 操作步骤</h2><p>创建支持向量机分类器的机制非常简单。有许多可用的选项。所以，我们执行下列操作：</p><ol><li><p>创建 SVC 对象，并训练一些伪造数据。</p></li><li><p>使用 SVC 对象训练一些示例数据。</p></li><li><p>稍微讨论一些 SVC 选项。</p></li></ol><p>从支持向量机模块导入支持向量分类器（SVC）：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> base_svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> base_svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><p>让我们看一些属性：</p><ul><li><p><code>C</code> ：以防我们的数据集不是分离好的， <code>C</code> 会在间距上放大误差。随着 <code>C</code> 变大，误差的惩罚也会变大，SVM 会尝试寻找一个更窄的间隔，即使它错误分类了更多数据点。</p></li><li><p><code>class_weight</code> ：这个表示问题中的每个类应该给予多少权重。这个选项以字典提供，其中类是键，值是与这些类关联的权重。</p></li><li><p><code>gamma</code> ：这是用于核的 Gamma 参数，并且由 <code>rgb, sigmoid</code> 和 <code>ploy</code> 支持。</p></li><li><p><code>kernel</code> ：这是所用的核，我们在下面使用 <code>linear</code> 核，但是 <code>rgb</code> 更流行，并且是默认选项。</p></li></ul><h2 id="工作原理-5"><a class="anchor" href="#工作原理-5">#</a> 工作原理</h2><p>我们在准备一节中说过，SVM 会尝试寻找一个屏幕，它使两个类别最优分割。让我们查看带有两个特征的最简单示例，以及一个良好分割的结果。</p><p>首先，让我们训练数据集，之后我们将其绘制出来。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_blobs<span class="token punctuation">(</span>n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> centers<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> LinearSVC </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> svm <span class="token operator">=</span> LinearSVC<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr></table></figure><p>既然我们训练了支持向量机，我们将图中每个点结果绘制出来。这会向我们展示近似的决策边界。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> itertools <span class="token keyword">import</span> product </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> collections <span class="token keyword">import</span> namedtuple</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> Point <span class="token operator">=</span> namedtuple<span class="token punctuation">(</span><span class="token string">'Point'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'outcome'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> decision_boundary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> xpt<span class="token punctuation">,</span> ypt <span class="token keyword">in</span> product<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>xmin<span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">,</span> xmax<span class="token operator">+</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>ymin<span class="token operator">-</span><span class="token number">2.5</span><span class="token punctuation">,</span> ymax<span class="token operator">+</span><span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        p <span class="token operator">=</span> Point<span class="token punctuation">(</span>xpt<span class="token punctuation">,</span> ypt<span class="token punctuation">,</span> svm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span>xpt<span class="token punctuation">,</span> ypt<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            decision_boundary<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> colors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> xpt<span class="token punctuation">,</span> ypt<span class="token punctuation">,</span> pt <span class="token keyword">in</span> decision_boundary<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>xpt<span class="token punctuation">,</span> ypt<span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span>pt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.15</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        ax<span class="token punctuation">.</span>set_ylim<span class="token punctuation">(</span>ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        ax<span class="token punctuation">.</span>set_xlim<span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"A well separated dataset"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-5-1.jpg" alt=""></p><p>让我们看看其他例子，但是这一次决策边界不是那么清晰：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span>n_features<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                                        n_classes<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>            </pre></td></tr><tr><td data-num="3"></td><td><pre>                                        n_informative<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>        </pre></td></tr><tr><td data-num="4"></td><td><pre>                                        n_redundant<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们已经看到，这并不是用线性分类易于解决的问题。</p><p>虽然我们不会将其用于实战，让我们看一看决策边界。首先，让我们使用新的数据点重新训练分类器。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>xx<span class="token punctuation">,</span> yy<span class="token punctuation">]</span> <span class="token keyword">for</span> xx<span class="token punctuation">,</span> yy <span class="token keyword">in</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                           product<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                           np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_preds <span class="token operator">=</span> svm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_points<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> colors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>test_points<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_points<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>               color<span class="token operator">=</span>colors<span class="token punctuation">[</span>test_preds<span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.25</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"A well separated dataset"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-5-2.jpg" alt=""></p><p>我们可以看到，决策边界并不完美，但是最后，这是我们获得的最好的线性 SVM。</p><h2 id="更多-3"><a class="anchor" href="#更多-3">#</a> 更多</h2><p>随让我们可能不能获得更好的线性 SVM，Scikit 中的 SVC 分类器会使用径向基函数。我们之前看过这个函数，但是让我们观察它如何计算我们刚刚拟合的数据集的决策边界。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> radial_svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> radial_svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> xmin<span class="token punctuation">,</span> xmax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ymin<span class="token punctuation">,</span> ymax <span class="token operator">=</span> np<span class="token punctuation">.</span>percentile<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>xx<span class="token punctuation">,</span> yy<span class="token punctuation">]</span> <span class="token keyword">for</span> xx<span class="token punctuation">,</span> yy <span class="token keyword">in</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                           product<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>xmin<span class="token punctuation">,</span> xmax<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                           np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>ymin<span class="token punctuation">,</span> ymax<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_preds <span class="token operator">=</span> radial_svm<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_points<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> f<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> colors <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'r'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>test_points<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> test_points<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>               color<span class="token operator">=</span>colors<span class="token punctuation">[</span>test_preds<span class="token punctuation">]</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">.25</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span>colors<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">"SVM with a radial basis function"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-5-3.jpg" alt=""></p><p>我们可以看到，决策边界改变了。我们甚至可以传入我们自己的径向基函数，如果需要的话：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">test_kernel</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token triple-quoted-string string">""" Test kernel that returns the exponentiation of the dot of the</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        X and y matrices.</pre></td></tr><tr><td data-num="4"></td><td><pre>        This looks an awful lot like the log hazards if you're familiar with survival analysis.    </pre></td></tr><tr><td data-num="5"></td><td><pre>        """</pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">return</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span>np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">.</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_svc <span class="token operator">=</span> SVC<span class="token punctuation">(</span>kernel<span class="token operator">=</span>test_kernel<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> test_svc<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>SVC<span class="token punctuation">(</span>C<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> cache_size<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> class_weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> coef0<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span> degree<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    gamma<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>   kernel<span class="token operator">=</span><span class="token operator">&lt;</span>function test_kernel at <span class="token number">0x121fdfb90</span><span class="token operator">></span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    max_iter<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>   probability<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>     </pre></td></tr><tr><td data-num="12"></td><td><pre>    shrinking<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">,</span>   verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="使用多类分类来归纳"><a class="anchor" href="#使用多类分类来归纳">#</a> 使用多类分类来归纳</h1><p>这个秘籍中，我们会了解多类分类。取决于你的算法选择，你可以轻松地实现多类分类，或者定义用于比较的模式。</p><h2 id="准备-6"><a class="anchor" href="#准备-6">#</a> 准备</h2><p>在处理线性模型，例如逻辑回归时，我们需要使用 <code>OneVsRestClassifier</code> 。这个模式会为每个类创建一个分类器。</p><h2 id="操作步骤-6"><a class="anchor" href="#操作步骤-6">#</a> 操作步骤</h2><p>首先，我们会查看一个决策树的粗略示例，用于拟合多类的数据集。我们之前讨论过，我们可以使用一些分类器获得多类，所以我们仅仅拟合示例来证明它可以工作，然后继续。</p><p>其次，我们实际上将 <code>OneVsRestClassifier</code> 合并进我的模型中：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span>n_samples<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> n_classes<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                        n_informative<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> dt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>你可以看到，我们能够以最低努力来拟合分类器。</p><p>现在，让我们转向多类分类器的案例中。这需要我们导入 <code>OneVsRestClassifier</code> 。我们也导入 <code>LogisticRegression</code> 。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>multiclass <span class="token keyword">import</span> OneVsRestClassifier </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>linear_model <span class="token keyword">import</span> LogisticRegression</pre></td></tr></table></figure><p>现在，我们覆盖 <code>LogisticRegression</code> 分类器，同时，注意我们可以使其并行化。如果我们想知道 <code>OneVsRestClassifier</code> 分类器如何工作，它仅仅是训练单独的模型，之后比较它们。所以，我们可以同时单独训练数据。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mlr <span class="token operator">=</span> OneVsRestClassifier<span class="token punctuation">(</span>LogisticRegression<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n_jobs<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mlr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mlr<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="工作原理-6"><a class="anchor" href="#工作原理-6">#</a> 工作原理</h2><p>如果我们打算快速时间我们自己的 <code>OneVsRestClassifier</code> ，应该怎么做呢？</p><p>首先，我们需要构造一种方式，来迭代分类，并为每个分类训练分类器。之后，我们首先需要预测每个分类：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">def</span> <span class="token function">train_one_vs_rest</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> class_label<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        y_train <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> class_label<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token keyword">return</span> y_train</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classifiers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> class_i <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>       l <span class="token operator">=</span> LogisticRegression<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        y_train <span class="token operator">=</span> train_one_vs_rest<span class="token punctuation">(</span>y<span class="token punctuation">,</span> class_i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        l<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        classifiers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l<span class="token punctuation">)</span></pre></td></tr></table></figure><p>好的，所以既然我们配置好了 OneVsRest 模式，我们需要做的所有事情，就是求出每个数据点对于每个分类器的可能性。我们之后将可能性最大的分类赋给数据点。</p><p>例如，让我们预测 <code>X[0]</code> ：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> classifier <span class="token keyword">in</span> classifiers </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span>  <span class="token keyword">print</span> classifier<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.90443776</span>  <span class="token number">0.09556224</span><span class="token punctuation">]</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.03701073</span>  <span class="token number">0.96298927</span><span class="token punctuation">]</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0.98492829</span>  <span class="token number">0.01507171</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>你可以看到，第二个分类器（下标为 <code>1</code> ）拥有 “正” 的最大可能性，所以我们将这个点标为 <code>1</code> 。</p><h1 id="将-lda-用于分类"><a class="anchor" href="#将-lda-用于分类">#</a> 将 LDA 用于分类</h1><p>线性判别分析（LDA）尝试拟合特征的线性组合，来预测结果变量。LDA 通常用作预处理步骤，我们会在这篇秘籍中涉及这两种方法。</p><h2 id="准备-7"><a class="anchor" href="#准备-7">#</a> 准备</h2><p>这篇秘籍中，我们会做这些事情：</p><ol><li><p>从雅虎获取股票数据</p></li><li><p>将其重新排列为我们熟悉的形状</p></li><li><p>创建 LDA 对象来拟合和预测类标签</p></li><li><p>给出如何使用 LDA 来降维的示例</p></li></ol><h2 id="操作步骤-7"><a class="anchor" href="#操作步骤-7">#</a> 操作步骤</h2><p>这个例子中，我们就执行一种分析，类似于 Altman 的 Z 规范化。在他的论文中，Altamn 基于多种金融度量，预测了公司两年内的违约可能性。从它的维基页面中，我们看到了下面这些东西：</p><p>T1 = 流动资产 / 总资产。相对于公司规模来度量流动资产。</p><p>T2 = 留存收益 / 总资产。度量反映公司年龄和盈利能力的收益率。</p><p>T3 = 利息和税前的收益 / 总资产。度量税和杠杆系数之外的运作效率。它是运作收益，对于长期生存非常重要。</p><p>T4 = 股权市值 / 总负债的账面价值。添加市场维度，可以将证券价格波动展示为危险信号。</p><p>T5 = 营业额 / 总资产。总资产周转的标准度量（每个产业的变化都很大）。</p><p>这段来自维基百科：</p><p>[1] Altman, Edward I. (September 1968). &quot;&quot;Financial Ratios, Discriminant Analysis and the Prediction of Corporate Bankruptcy&quot;&quot;. Journal of Finance: 189–209.</p><p>这个分析中，我们使用 Pandas 从雅虎抓取一些金融数据。我们尝试预测，股票是否在六个月内会涨，基于股票的当前属性。很显然没有比 Altman 的 Z 规范化更精妙的东西了。让我们使用一些汽车股票：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> tickers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"F"</span><span class="token punctuation">,</span> <span class="token string">"TM"</span><span class="token punctuation">,</span> <span class="token string">"GM"</span><span class="token punctuation">,</span> <span class="token string">"TSLA"</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> pandas<span class="token punctuation">.</span>io <span class="token keyword">import</span> data <span class="token keyword">as</span> external_data </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> stock_panel <span class="token operator">=</span> external_data<span class="token punctuation">.</span>DataReader<span class="token punctuation">(</span>tickers<span class="token punctuation">,</span> <span class="token string">"yahoo"</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>这个数据结构是 <code>panel</code> ，类似于 OLAP 立方体，或者三维的 <code>DataFrame</code> 。让我们看看这些数据，来熟悉一下收盘价，因为我们在比较时只考虑它。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> stock_df <span class="token operator">=</span> stock_panel<span class="token punctuation">.</span>Close<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> stock_df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>下面是输出：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-7-1.jpg" alt=""></p><p>好的，所以现在我们需要将每支股票的价格和它六个月内的价格比较。如果更高，置为 1，否则置为 0。</p><p>为此，我们只需要将其向前移动 180 天并比较：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#this dataframe indicates if the stock was higher in 180 days </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classes <span class="token operator">=</span> <span class="token punctuation">(</span>stock_df<span class="token punctuation">.</span>shift<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span> <span class="token operator">></span> stock_df<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们需要做的下一件事，就是展开数据集：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X <span class="token operator">=</span> stock_panel<span class="token punctuation">.</span>to_frame<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classes <span class="token operator">=</span> classes<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classes <span class="token operator">=</span> classes<span class="token punctuation">.</span>swaplevel<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classes <span class="token operator">=</span> classes<span class="token punctuation">.</span>to_frame<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> classes<span class="token punctuation">.</span>index<span class="token punctuation">.</span>names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Date'</span><span class="token punctuation">,</span> <span class="token string">'minor'</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> data <span class="token operator">=</span> X<span class="token punctuation">.</span>join<span class="token punctuation">(</span>classes<span class="token punctuation">)</span><span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> data<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'is_higher'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> data<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-7-2.jpg" alt=""></p><p>好的，我们现在需要为 SciPy 创建矩阵。为此，我们会使用 <code>patsy</code> 库。这是一个非常棒的库，可以用于创建和 R 相似的决策矩阵。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> patsy </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X <span class="token operator">=</span> patsy<span class="token punctuation">.</span>dmatrix<span class="token punctuation">(</span>"Open <span class="token operator">+</span> High <span class="token operator">+</span> Low <span class="token operator">+</span> Close <span class="token operator">+</span> Volume <span class="token operator">+</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                       is_higher <span class="token operator">-</span> <span class="token number">1</span>"<span class="token punctuation">,</span> data<span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                       return_type<span class="token operator">=</span><span class="token string">'dataframe'</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>输出如下：</p><p><img data-src="/assets/computer-science/machine-learing/Scikit-learn-Cookbook/4-7-3.jpg" alt=""></p><p><code>patsy</code> 是个非常强大的包。例如，假设我们打算使用第一章的一些预处理。在 <code>patsy</code> 中，可以像 R 一样，修改公式相当于修改决策矩阵。这里并不会这么做，但是如果我们打算将数据缩放为均值 0 和标准差 1，函数就是 <code>scale(open) + scale(high)</code> 。</p><p>太棒了。所以现在我们得到了数据集。让我们训练 LDA 对象吧。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>lda <span class="token keyword">import</span> LDA </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> lda <span class="token operator">=</span> LDA<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> lda<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>我们可以看到，数据集的预测并不是非常糟糕。确实，我们打算使用其他参数改进并测试模型：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> classification_report<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                lda<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>             precision     recall    f1<span class="token operator">-</span>score     support </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">0.0</span>               <span class="token number">0.63</span>       <span class="token number">0.59</span>        <span class="token number">0.61</span>        <span class="token number">1895</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">1.0</span>               <span class="token number">0.60</span>       <span class="token number">0.64</span>        <span class="token number">0.62</span>        <span class="token number">1833</span></pre></td></tr><tr><td data-num="7"></td><td><pre>avg <span class="token operator">/</span> total       <span class="token number">0.61</span>       <span class="token number">0.61</span>        <span class="token number">0.61</span>        <span class="token number">3728</span></pre></td></tr></table></figure><p>这些度量以多种方式描述了模型如何拟合数据。</p><ul><li><p>对于 <code>precision</code> （准确率），假设模型预测正值，多大比例这个是对的？（ <code>TP / (TP + FP)</code> ）</p></li><li><p>对于 <code>recall</code> （召回率），假设某个类的状态是正确的，我们选取了多大的比例？由于召回率是搜索问题中的常见度量，所以我用 “选取”。例如，有一些潜在的网页和搜索术语相关，也就是返回的比例。（ <code>TP / (TP + FN)</code> ）</p></li><li><p><code>f1-score</code> 参数尝试总结二者关系。（ <code>2 * p * r / (p + r)</code> ）</p></li></ul><h2 id="工作原理-7"><a class="anchor" href="#工作原理-7">#</a> 工作原理</h2><p>LDA 实际上非常类似于我们之前做过的聚类。我们从数据训练线性模型。之后，一旦我们拥有了模型，我们尝试预测并比较每个类的数据的可能性。我们选择更加常见的选项。</p><p>LDA 实际上是 QDA 的简化，我们会在下一节谈到它。这里，我们假设每个类的协方差都是一样的，但是 QDA 中，这个假设是不严格的。可以将它们的关系类比为 KNN 和 GMM。</p><h1 id="使用-qda-非线性-lda"><a class="anchor" href="#使用-qda-非线性-lda">#</a> 使用 QDA - 非线性 LDA</h1><p>QDA 是一些通用技巧的推广，例如平方回归。它只是模型的推广，能够拟合更复杂的模型。但是，就像其它东西那样，当混入复杂性时，就更加困难了。</p><h2 id="准备-8"><a class="anchor" href="#准备-8">#</a> 准备</h2><p>我们会扩展上一个秘籍，并通过 QDA 对象查看平方判别分析（QDA）。</p><p>我们说过我们会根据模型的协方差做出假设。这里，我们会缓和这个假设。</p><h2 id="操作步骤-8"><a class="anchor" href="#操作步骤-8">#</a> 操作步骤</h2><p>QDA 是 <code>qda</code> 模块的一个成员。使用下列命令来使用 QDA：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>qda <span class="token keyword">import</span> QDA </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> qda <span class="token operator">=</span> QDA<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> qda<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> predictions <span class="token operator">=</span> qda<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> predictions<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2812.0</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>metrics <span class="token keyword">import</span> classification_report </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> classification_report<span class="token punctuation">(</span>X<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">,</span> predictions<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>              precision     recall     f1<span class="token operator">-</span>score     support </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">0.0</span>                <span class="token number">0.75</span>       <span class="token number">0.36</span>        <span class="token number">0.49</span>         <span class="token number">1895</span> </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">1.0</span>                <span class="token number">0.57</span>       <span class="token number">0.88</span>        <span class="token number">0.69</span>         <span class="token number">1833</span> </pre></td></tr><tr><td data-num="15"></td><td><pre>avg <span class="token operator">/</span> total        <span class="token number">0.66</span>       <span class="token number">0.62</span>        <span class="token number">0.59</span>         <span class="token number">3728</span></pre></td></tr></table></figure><p>你可以看到，总体来说都差不多。如果我们回顾 LDA 秘籍，我们可以看到，与 QDA 相比，类 0 有很大变化，类 1 变化很小。</p><h2 id="工作原理-8"><a class="anchor" href="#工作原理-8">#</a> 工作原理</h2><p>我们在上一个秘籍中提到过，我们本质上在这里比较可能性。所以，如何比较可能性呢？让我们使用价格来尝试对 <code>is_higher</code> 分类。</p><p>我们假设收盘价服从对数正态分布。为了计算每个类的可能性，我们需要为每个类创建收盘价的子集，以及训练集和测试集。作为下一章的前瞻，我们使用内建的交叉验证方法：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> cross_validation <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> scipy<span class="token punctuation">.</span>stats <span class="token keyword">as</span> sp</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">for</span> test<span class="token punctuation">,</span> train <span class="token keyword">in</span> cv<span class="token punctuation">.</span>ShuffleSplit<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">.</span>Close<span class="token punctuation">)</span><span class="token punctuation">,</span> n_iter<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        train_set <span class="token operator">=</span> X<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        train_close <span class="token operator">=</span> train_set<span class="token punctuation">.</span>Close</pre></td></tr><tr><td data-num="6"></td><td><pre>        </pre></td></tr><tr><td data-num="7"></td><td><pre>        train_0 <span class="token operator">=</span> train_close<span class="token punctuation">[</span><span class="token operator">~</span>train_set<span class="token punctuation">.</span>is_higher<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">]</span>       </pre></td></tr><tr><td data-num="8"></td><td><pre>        train_1 <span class="token operator">=</span> train_close<span class="token punctuation">[</span>train_set<span class="token punctuation">.</span>is_higher<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">]</span>           </pre></td></tr><tr><td data-num="9"></td><td><pre>        </pre></td></tr><tr><td data-num="10"></td><td><pre>        test_set <span class="token operator">=</span> X<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>test<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        test_close <span class="token operator">=</span> test_set<span class="token punctuation">.</span>Close<span class="token punctuation">.</span>values</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>        ll_0 <span class="token operator">=</span> sp<span class="token punctuation">.</span>norm<span class="token punctuation">.</span>pdf<span class="token punctuation">(</span>test_close<span class="token punctuation">,</span> train_0<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       </pre></td></tr><tr><td data-num="14"></td><td><pre>        ll_1 <span class="token operator">=</span> sp<span class="token punctuation">.</span>norm<span class="token punctuation">.</span>pdf<span class="token punctuation">(</span>test_close<span class="token punctuation">,</span> train_1<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们有了两个类的可能性，我们可以比较和分配类：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span>ll_0 <span class="token operator">></span> ll_1<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">0.15588673621460505</span></pre></td></tr></table></figure><h1 id="使用随机梯度下降来分类"><a class="anchor" href="#使用随机梯度下降来分类">#</a> 使用随机梯度下降来分类</h1><p>我们在第二章中讨论过，随机梯度下降是个用于训练分类模型的基本技巧。这两种技巧之间有一些自然联系，因为名称就暗示了这一点。</p><h2 id="准备-9"><a class="anchor" href="#准备-9">#</a> 准备</h2><p>在回归中，我们最小化了损失函数，它用于惩罚连续刻度上的不良选择。但是对于分类，我们会最小化损失函数，它用于乘法两个或更多情况。</p><h2 id="操作步骤-9"><a class="anchor" href="#操作步骤-9">#</a> 操作步骤</h2><p>首先，让我们创建一些基本数据：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> y <span class="token operator">=</span> datasets<span class="token punctuation">.</span>make_classification<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>然后创建 <code>SGDClassifier</code> 实例：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> linear_model </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> sgd_clf <span class="token operator">=</span> linear_model<span class="token punctuation">.</span>SGDClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>像往常一样，我们训练模型：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> sgd_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>SGDClassifier<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">,</span> class_weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> epsilon<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> eta0<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>              fit_intercept<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> l1_ratio<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>              learning_rate<span class="token operator">=</span><span class="token string">'optimal'</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'hinge'</span><span class="token punctuation">,</span> n_iter<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>              n_jobs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> penalty<span class="token operator">=</span><span class="token string">'l2'</span><span class="token punctuation">,</span> power_t<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>              random_state<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>              shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> warm_start<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们可以设置 <code>class_weight</code> 参数来统计数据集中不平衡的变化总数。</p><p>Hinge 损失函数定义为：</p><pre><code>max(0, 1 - ty)
</code></pre><p>这里， <code>t</code> 是真正分类，+1 为一种情况，-1 为另一种情况。系数向量记为 <code>y</code> ，因为它是从模型中拟合出来的。 <code>x</code> 是感兴趣的值。这也是一种很好的度量方式。以另外一种形式表述：</p><pre><code>t ∈ -1, 1
y = βx + b
</code></pre><h1 id="使用朴素贝叶斯来分类数据"><a class="anchor" href="#使用朴素贝叶斯来分类数据">#</a> 使用朴素贝叶斯来分类数据</h1><p>朴素分页四是个非常有意思的模型。它类似于 KNN，做了一些假设来简化事实，但是仍然在许多情况下都很好。</p><h2 id="准备-10"><a class="anchor" href="#准备-10">#</a> 准备</h2><p>这个秘籍中，我们会使用朴素贝叶斯来分类文档。我拥有个人经验的一个示例就是，使用会计学中的组成账户描述符的单词，例如应付账款，来判断它属于利润表、现金流转表、还是资产负债表。</p><p>基本理念是使用来自带标签的测试语料库中的词频，来学习文档的分类。之后，我们可以将其用在训练集上来尝试预测标签。</p><p>我们使用 Sklearn 中的 <code>newgroups</code> 数据集来玩转朴素贝叶斯模型。这是有价值的一组数据，所以我们抓取它而不是加载它。我们也将分类限制为 <code>rec.autos</code> 和 <code>rec.motorcycles</code> 。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_20newsgroups</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"rec.autos"</span><span class="token punctuation">,</span> <span class="token string">"rec.motorcycles"</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> newgroups <span class="token operator">=</span> fetch_20newsgroups<span class="token punctuation">(</span>categories<span class="token operator">=</span>categories<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#take a look </span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span> <span class="token string">"\n"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>newgroups<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>From<span class="token punctuation">:</span> gregl@zimmer<span class="token punctuation">.</span>CSUFresno<span class="token punctuation">.</span>EDU <span class="token punctuation">(</span>Greg Lewis<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="9"></td><td><pre>Subject<span class="token punctuation">:</span> Re<span class="token punctuation">:</span> WARNING<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>please read<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> </pre></td></tr><tr><td data-num="10"></td><td><pre>Keywords<span class="token punctuation">:</span> BRICK<span class="token punctuation">,</span> TRUCK<span class="token punctuation">,</span> DANGER </pre></td></tr><tr><td data-num="11"></td><td><pre>Nntp<span class="token operator">-</span>Posting<span class="token operator">-</span>Host<span class="token punctuation">:</span> zimmer<span class="token punctuation">.</span>csufresno<span class="token punctuation">.</span>edu </pre></td></tr><tr><td data-num="12"></td><td><pre>Organization<span class="token punctuation">:</span> CSU Fresno </pre></td></tr><tr><td data-num="13"></td><td><pre>Lines<span class="token punctuation">:</span> <span class="token number">33</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>…<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> newgroups<span class="token punctuation">.</span>target_names<span class="token punctuation">[</span>newgroups<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token string">'rec.autos'</span></pre></td></tr></table></figure><p>既然我们拥有了 <code>newgroups</code> ，我们需要将每个文档表示为词频向量。这个表示就是朴素贝叶斯名称的来历。模型是 “朴素” 的，不按照任何文档间的单词协方差，来对文档进行分类。这可以认为是可以缺陷，但是朴素贝叶斯已经被证实相当可靠。</p><p>我们需要将数据处理为词频矩阵。这是个稀疏矩阵，当某个单词出现在文档中时，这个单词就有条目。这个矩阵可能非常大，就像这样：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>feature_extraction<span class="token punctuation">.</span>text <span class="token keyword">import</span> CountVectorizer</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> count_vec <span class="token operator">=</span> CountVectorizer<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> bow <span class="token operator">=</span> count_vec<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>newgroups<span class="token punctuation">.</span>data</pre></td></tr></table></figure><p>这个矩阵是个稀疏矩阵，它的长度是文档数量乘以不同单词的数量。它的值是每个文档中每个单词的频率。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> bow <span class="token operator">&lt;</span>1192x19177 sparse matrix of <span class="token builtin">type</span> <span class="token string">'&lt;type '</span>numpy<span class="token punctuation">.</span>int64<span class="token string">'>'</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">with</span> <span class="token number">164296</span> stored elements <span class="token keyword">in</span> Compressed Sparse Row <span class="token builtin">format</span><span class="token operator">></span></pre></td></tr></table></figure><p>我们实际上需要将矩阵表示为密集数组，用于朴素贝叶斯对象。所以，让我们将其转换回来。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> bow <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>bow<span class="token punctuation">.</span>todense<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>显然，多数元素都是 0，但是我们可能打算重构文档的统计，作为合理性检查。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> words <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>count_vec<span class="token punctuation">.</span>get_feature_names<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> words<span class="token punctuation">[</span>bow<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="3"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">u'10pm'</span><span class="token punctuation">,</span> <span class="token string">u'1qh336innfl5'</span><span class="token punctuation">,</span> <span class="token string">u'33'</span><span class="token punctuation">,</span> <span class="token string">u'93740'</span><span class="token punctuation">,</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">u'___________________________________________________________________'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>dtype<span class="token operator">=</span><span class="token string">'&lt;U79'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>现在，这些就是第一个文档的示例了？让我们使用下面的命令：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'10pm'</span> <span class="token keyword">in</span> newgroups<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token boolean">True</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token string">'1qh336innfl5'</span> <span class="token keyword">in</span> newgroups<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token boolean">True</span></pre></td></tr></table></figure><h2 id="操作步骤-10"><a class="anchor" href="#操作步骤-10">#</a> 操作步骤</h2><p>好的，所以需要比平常更多的时间来准备数据，因为我们处理的文本数据，并不是能够像之前的矩阵那样快速表示。</p><p>但是，既然我们准备好了，我们启动分类器来训练我们的模型。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> naive_bayes </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> clf <span class="token operator">=</span> naive_bayes<span class="token punctuation">.</span>GaussianNB<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>在我们训练模型之前，让我们将数据集划分为训练集和测试集。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mask <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>bow<span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>bow<span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">,</span> newgroups<span class="token punctuation">.</span>target<span class="token punctuation">[</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> predictions <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>bow<span class="token punctuation">[</span><span class="token operator">~</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>既然我们在训练集训练了模型，之后预测测试集来尝试判断文章属于哪个分类，让我们获取准确率。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>predictions <span class="token operator">==</span> newgroups<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token operator">~</span>mask<span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">0.92446043165467628</span></pre></td></tr></table></figure><h2 id="工作原理-9"><a class="anchor" href="#工作原理-9">#</a> 工作原理</h2><p>朴素贝叶斯的基本原理，就是我们可以根据特征向量，来估计数据点属于分类的概率（ <code>P(Ci|X)</code> ）。</p><p>这可以使用贝叶斯定期来变形，来变成特征向量的后验概率（ <code>P(X|Ci)</code> ）。如果特征向量的概率最大，那么后延估计就选择这个分类。</p><h2 id="更多-4"><a class="anchor" href="#更多-4">#</a> 更多</h2><p>我们也可以将朴素贝叶斯扩展来执行多类分类。我们不适用高斯可能性，而是使用多项式可能性。</p><p>首先，让我们获取第三个分类：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> fetch_20newsgroups </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_categories <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"rec.autos"</span><span class="token punctuation">,</span> <span class="token string">"rec.motorcycles"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                     <span class="token string">"talk.politics.guns"</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_newgroups <span class="token operator">=</span> fetch_20newsgroups<span class="token punctuation">(</span>categories<span class="token operator">=</span>mn_categories<span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们需要将这些东西向量化。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_bow <span class="token operator">=</span> count_vec<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>mn_newgroups<span class="token punctuation">.</span>data<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_bow <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>mn_bow<span class="token punctuation">.</span>todense<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>让我们创建为训练集和测试集创建一个屏蔽数组。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_mask <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mn_newgroups<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> multinom <span class="token operator">=</span> naive_bayes<span class="token punctuation">.</span>MultinomialNB<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> multinom<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>mn_bow<span class="token punctuation">[</span>mn_mask<span class="token punctuation">]</span><span class="token punctuation">,</span> mn_newgroups<span class="token punctuation">.</span>target<span class="token punctuation">[</span>mn_mask<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> mn_predict <span class="token operator">=</span> multinom<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>mn_bow<span class="token punctuation">[</span><span class="token operator">~</span>mn_mask<span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>mn_predict <span class="token operator">==</span> mn_newgroups<span class="token punctuation">.</span>target<span class="token punctuation">[</span><span class="token operator">~</span>mn_mask<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token number">0.96594778660612934</span></pre></td></tr></table></figure><p>我们做的很好，完全不会惊讶。我们在两个分类的情况下表现不错，由于 <code>talk.politics.guns</code> 分类和其它两个正交，我们应该也表现不错。</p><h1 id="标签传递半监督学习"><a class="anchor" href="#标签传递半监督学习">#</a> 标签传递，半监督学习</h1><p>标签传递是个半监督学习技巧，它利用带标签和不带标签的数据，来了解不带标签的数据。通常，受益于分类算法的数据是难以标注的。例如，标注数据的开销可能非常大，所以手动标注一个子集边角高效。也就是说，对于公司雇佣分类学家来说，存在可能较慢，但是在发展的支持。</p><h2 id="准备-11"><a class="anchor" href="#准备-11">#</a> 准备</h2><p>另一个问题范围就是截尾数据。你可以想象一种情况，其中时间的边界会影响你收集数据的能力。也就是说，例如，你将试验药物给病人，并测量它们。有些时候，你能够测量药物的结果。如果碰巧足够快，但是你可能打算预测药物的结果，它们的反应时间较慢。这些药物可能对一些病人有致命的反应，并且需要采取救生措施。</p><h2 id="操作步骤-11"><a class="anchor" href="#操作步骤-11">#</a> 操作步骤</h2><p>为了表示半监督或者截尾数据，我们需要做一些简单的数据处理。首先，我们会浏览一个简单的示例，之后转向一些更加困难的情况。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> d <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>由于我们会将数据搞乱，我们做一个备份，并向标签名称数组的副本添加一个 <code>unlabeled</code> 成员。它会使数据的识别变得容易。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> X <span class="token operator">=</span> d<span class="token punctuation">.</span>data<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> d<span class="token punctuation">.</span>target<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> names <span class="token operator">=</span> d<span class="token punctuation">.</span>target_names<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> names <span class="token operator">=</span> np<span class="token punctuation">.</span>append<span class="token punctuation">(</span>names<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'unlabeled'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> names </pre></td></tr><tr><td data-num="6"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'setosa'</span><span class="token punctuation">,</span> <span class="token string">'versicolor'</span><span class="token punctuation">,</span> <span class="token string">'virginica'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>       dtype<span class="token operator">=</span><span class="token string">'|S10'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>现在使用 <code>-1</code> 更新 <code>y</code> ，这就是未标注情况的记号。这也是我们将 <code>unlabeled</code> 添加到末尾的原因。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> y<span class="token punctuation">[</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr></table></figure><p>我们的数据现在拥有一系列负值（ <code>-1</code> ），散布在真正数据当中：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> names<span class="token punctuation">[</span>y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'setosa'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>       <span class="token string">'setosa'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">,</span> <span class="token string">'setosa'</span><span class="token punctuation">,</span> <span class="token string">'unlabeled'</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>       dtype<span class="token operator">=</span><span class="token string">'|S10'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们显然拥有一大堆未标注的数据，现在的目标是使用 <code>LabelPropagation</code> 来预测标签：</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> sklearn <span class="token keyword">import</span> semi_supervised </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> lp <span class="token operator">=</span> semi_supervised<span class="token punctuation">.</span>LabelPropagation<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> lp<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>LabelPropagation<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                 n_neighbors<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> preds <span class="token operator">=</span> lp<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span>preds <span class="token operator">==</span> d<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">0.98666666666666669</span></pre></td></tr></table></figure><p>并不是太坏。我们使用了所有数据，所以这是一种作弊。并且， <code>iris</code> 数据集是个良好分隔的数据集。</p><p>虽然我们完成了，让我们看看 <code>LabelSpreading</code> ，它是 <code>LabelPropagation</code> 的姐妹类。我们会在 “工作原理” 一节给出 <code>LabelSpreading</code> 和 <code>LabelPropagation</code> 的技术差异，但是很容易看出它们及其相似。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ls <span class="token operator">=</span> semi_supervised<span class="token punctuation">.</span>LabelSpreading<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>观察它的工作原理， <code>LabelSpreading</code> 更加健壮和嘈杂。</p><figure class="highlight py"><figcaption data-lang="Python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ls<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre>LabelSpreading<span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> gamma<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> kernel<span class="token operator">=</span><span class="token string">'rbf'</span><span class="token punctuation">,</span> max_iter<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>               n_neighbors<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> tol<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>               </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token punctuation">(</span>ls<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">==</span> d<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">0.96666666666666667</span></pre></td></tr></table></figure><p>不要认为标签传播算法丢失了几个指标，它就表现得更差了。关键是，我们可能提供一些预测训练集的能力，并且适用于更广泛的环境。</p><h2 id="工作原理-10"><a class="anchor" href="#工作原理-10">#</a> 工作原理</h2><p>标签传递的原理是，创建数据点的图，每条边上的权重为：</p><pre><code>wij(θ) = dij / θ^2
</code></pre><p>这个算法之后的原理是，数据点将它们的标签传递给未标记的数据点。这个传递部分由边的权重决定。</p><p>边上的权重可以放在转移概率矩阵中。我们可以迭代来估计实际的标签。</p><div class="tags"><a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="ic i-tag"></i> 机器学习</a> <a href="/tags/Scikit-learn-Cookbook/" rel="tag"><i class="ic i-tag"></i> Scikit-learn Cookbook</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-12-03 21:35:34" itemprop="dateModified" datetime="2021-12-03T21:35:34+08:00">2021-12-03</time> </span><span id="computer-science/machine-learing/Scikit-learn-Cookbook/第4章 使用 scikit-learn 对数据分类/" class="item leancloud_visitors" data-flag-title="第 4 章 使用 scikit-learn 对数据分类" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/images/wechatpay.jpg" alt="Hazuki 叶月 微信支付"><p>微信支付</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Hazuki 叶月 <i class="ic i-at"><em>@</em></i></li><li class="link"><strong>本文链接：</strong> <a href="https://hazuki.cn/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC4%E7%AB%A0%20%E4%BD%BF%E7%94%A8%20scikit-learn%20%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB/" title="第 4 章 使用 scikit-learn 对数据分类">https://hazuki.cn/computer-science/machine-learing/Scikit-learn-Cookbook/第4章 使用 scikit-learn 对数据分类/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC5%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E5%90%8E%E5%A4%84%E7%90%86/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciub8ja1j20zk0m81ky.jpg" title="第5章 模型后处理"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Scikit-learn Cookbook</span><h3>第5章 模型后处理</h3></a></div><div class="item right"><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC3%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciub8ja1j20zk0m81ky.jpg" title="第3章 使用距离向量构建模型"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> Scikit-learn Cookbook</span><h3>第3章 使用距离向量构建模型</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E4%BD%BF%E7%94%A8-scikit-learn-%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">第四章 使用 scikit-learn 对数据分类</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%B3%E7%AD%96%E6%A0%91%E5%AE%9E%E7%8E%B0%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">2.</span> <span class="toc-text">使用决策树实现基本的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">2.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-number">2.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">2.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E5%86%B3%E7%AD%96%E6%A0%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">调整决策树模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-2"><span class="toc-number">3.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-2"><span class="toc-number">3.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-2"><span class="toc-number">3.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%AE%B8%E5%A4%9A%E5%86%B3%E7%AD%96%E6%A0%91-%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97"><span class="toc-number">4.</span> <span class="toc-text">使用许多决策树 -- 随机森林</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-3"><span class="toc-number">4.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-3"><span class="toc-number">4.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-3"><span class="toc-number">4.3.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A"><span class="toc-number">4.4.</span> <span class="toc-text">更多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E6%A8%A1%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">调整随机森林模型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-4"><span class="toc-number">5.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-4"><span class="toc-number">5.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-4"><span class="toc-number">5.3.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A-2"><span class="toc-number">5.4.</span> <span class="toc-text">更多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB"><span class="toc-number">6.</span> <span class="toc-text">使用支持向量机对数据分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-5"><span class="toc-number">6.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-5"><span class="toc-number">6.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-5"><span class="toc-number">6.3.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A-3"><span class="toc-number">6.4.</span> <span class="toc-text">更多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%9A%E7%B1%BB%E5%88%86%E7%B1%BB%E6%9D%A5%E5%BD%92%E7%BA%B3"><span class="toc-number">7.</span> <span class="toc-text">使用多类分类来归纳</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-6"><span class="toc-number">7.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-6"><span class="toc-number">7.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-6"><span class="toc-number">7.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%86-lda-%E7%94%A8%E4%BA%8E%E5%88%86%E7%B1%BB"><span class="toc-number">8.</span> <span class="toc-text">将 LDA 用于分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-7"><span class="toc-number">8.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-7"><span class="toc-number">8.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-7"><span class="toc-number">8.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-qda-%E9%9D%9E%E7%BA%BF%E6%80%A7-lda"><span class="toc-number">9.</span> <span class="toc-text">使用 QDA - 非线性 LDA</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-8"><span class="toc-number">9.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-8"><span class="toc-number">9.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-8"><span class="toc-number">9.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E9%9A%8F%E6%9C%BA%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D%E6%9D%A5%E5%88%86%E7%B1%BB"><span class="toc-number">10.</span> <span class="toc-text">使用随机梯度下降来分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-9"><span class="toc-number">10.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-9"><span class="toc-number">10.2.</span> <span class="toc-text">操作步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%9D%A5%E5%88%86%E7%B1%BB%E6%95%B0%E6%8D%AE"><span class="toc-number">11.</span> <span class="toc-text">使用朴素贝叶斯来分类数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-10"><span class="toc-number">11.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-10"><span class="toc-number">11.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-9"><span class="toc-number">11.3.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A-4"><span class="toc-number">11.4.</span> <span class="toc-text">更多</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E4%BC%A0%E9%80%92%E5%8D%8A%E7%9B%91%E7%9D%A3%E5%AD%A6%E4%B9%A0"><span class="toc-number">12.</span> <span class="toc-text">标签传递，半监督学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%86%E5%A4%87-11"><span class="toc-number">12.1.</span> <span class="toc-text">准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4-11"><span class="toc-number">12.2.</span> <span class="toc-text">操作步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-10"><span class="toc-number">12.3.</span> <span class="toc-text">工作原理</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC1%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E9%A2%84%E5%A4%84%E7%90%86/" rel="bookmark" title="第1章 模型预处理">第1章 模型预处理</a></li><li><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC2%E7%AB%A0%20%E5%A4%84%E7%90%86%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/" rel="bookmark" title="第2章 处理线性模型">第2章 处理线性模型</a></li><li><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC3%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B/" rel="bookmark" title="第3章 使用距离向量构建模型">第3章 使用距离向量构建模型</a></li><li class="active"><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC4%E7%AB%A0%20%E4%BD%BF%E7%94%A8%20scikit-learn%20%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB/" rel="bookmark" title="第4章 使用 scikit-learn 对数据分类">第4章 使用 scikit-learn 对数据分类</a></li><li><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC5%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E5%90%8E%E5%A4%84%E7%90%86/" rel="bookmark" title="第5章 模型后处理">第5章 模型后处理</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Hazuki 叶月" data-src="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/images/avatar.jpg"><p class="name" itemprop="name">Hazuki 叶月</p><div class="description" itemprop="description">计算机基础 & 编程笔记</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">10</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">7</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hhenVraS0yOTU=" title="https:&#x2F;&#x2F;github.com&#x2F;Hazuki-295"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9sdW8tc2hlbmctNzYtMjItMzg=" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;luo-sheng-76-22-38"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly95Lm11c2ljLjE2My5jb20vbS91c2VyP2lkPTMwOTUzOTk5NA==" title="https:&#x2F;&#x2F;y.music.163.com&#x2F;m&#x2F;user?id&#x3D;309539994"><i class="ic i-cloud-music"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-magic"></i>链环</a><ul class="submenu"><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC5%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E5%90%8E%E5%A4%84%E7%90%86/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC3%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" title="分类于 Scikit-learn Cookbook">Scikit-learn Cookbook</a></div><span><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC2%E7%AB%A0%20%E5%A4%84%E7%90%86%E7%BA%BF%E6%80%A7%E6%A8%A1%E5%9E%8B/" title="第2章 处理线性模型">第2章 处理线性模型</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/operating-system/" title="分类于 操作系统">操作系统</a></div><span><a href="/computer-science/operating-system/Chapter1-Introduction/" title="Chapter 1 Introduction">Chapter 1 Introduction</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" title="分类于 Scikit-learn Cookbook">Scikit-learn Cookbook</a></div><span><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC3%E7%AB%A0%20%E4%BD%BF%E7%94%A8%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B/" title="第3章 使用距离向量构建模型">第3章 使用距离向量构建模型</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" title="分类于 Scikit-learn Cookbook">Scikit-learn Cookbook</a></div><span><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC1%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E9%A2%84%E5%A4%84%E7%90%86/" title="第1章 模型预处理">第1章 模型预处理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo/" title="分类于 Hexo 博客搭建">Hexo 博客搭建</a> <i class="ic i-angle-right"></i> <a href="/categories/hexo/Theme-Shoka/" title="分类于 Shoka 主题">Shoka 主题</a></div><span><a href="/hexo/Theme.Shoka/01_Shoka/" title="Shoka主题：修改切换标签时更换标题">Shoka主题：修改切换标签时更换标题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/computer-network/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-network/network-layer-1/" title="第4章 网络层：数据平面">第4章 网络层：数据平面</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/computer-network/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-network/application-layer/" title="第2章 应用层">第2章 应用层</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" title="分类于 Scikit-learn Cookbook">Scikit-learn Cookbook</a></div><span><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC5%E7%AB%A0%20%E6%A8%A1%E5%9E%8B%E5%90%8E%E5%A4%84%E7%90%86/" title="第5章 模型后处理">第5章 模型后处理</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/computer-network/" title="分类于 计算机网络">计算机网络</a></div><span><a href="/computer-science/computer-network/transport-layer/" title="第3章 传输层">第3章 传输层</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/" title="分类于 机器学习">机器学习</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/machine-learing/Scikit-learn-Cookbook/" title="分类于 Scikit-learn Cookbook">Scikit-learn Cookbook</a></div><span><a href="/computer-science/machine-learing/Scikit-learn-Cookbook/%E7%AC%AC4%E7%AB%A0%20%E4%BD%BF%E7%94%A8%20scikit-learn%20%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%88%86%E7%B1%BB/" title="第4章 使用 scikit-learn 对数据分类">第4章 使用 scikit-learn 对数据分类</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Hazuki 叶月 @ Hazuki の 小屋</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">165k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:30</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"computer-science/machine-learing/Scikit-learn-Cookbook/第4章 使用 scikit-learn 对数据分类/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="//cdn.jsdelivr.net/gh/Hazuki-295/Hazuki-295.github.io@v1.0.2/js/app.js?v=0.2.5"></script></body></html>